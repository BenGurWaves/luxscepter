<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lux Scepter ‚Äî Realm</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Chomsky&display=swap');
body {
  margin: 0;
  font-family: 'Times New Roman', serif;
  background-color: #0e0e0e;
  color: #bd8e20;
}
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1em 2em;
  background: #35005a;
  color: #bd8e20;
}
header h1 {
  font-family: 'Chomsky', sans-serif;
  font-size: 2em;
}
nav button {
  background: #5600a1;
  border: none;
  color: #fff;
  padding: 0.5em 1em;
  margin-left: 1em;
  border-radius: 6px;
  cursor: pointer;
}
nav button:hover {
  background: #35005a;
}
.container {
  display: flex;
  margin: 2em;
}
#feed {
  flex: 3;
  margin-right: 2em;
}
.post {
  background: #0e0e0e;
  border: 2px solid #571728;
  border-radius: 10px;
  margin-bottom: 1em;
  padding: 1em;
}
.post video {
  width: 100%;
  border-radius: 8px;
}
.sidebar {
  flex: 1;
}
#oracle {
  position: fixed;
  right: 0;
  top: 0;
  width: 40px;
  height: 100vh;
  background: linear-gradient(to bottom, #bd8e20 0%, #571728 100%);
  cursor: pointer;
}
#oracle.expanded {
  width: 300px;
  transition: width 0.5s;
  overflow: auto;
}
#oracle input {
  width: 100%;
  padding: 0.5em;
  margin: 0.5em;
  border-radius: 6px;
  border: 1px solid #35005a;
  background: #0e0e0e;
  color: #bd8e20;
}
.upload-section {
  background: #0e0e0e;
  border: 2px solid #35005a;
  padding: 1em;
  margin-bottom: 2em;
  border-radius: 10px;
}
button.upload-btn {
  background: #bd8e20;
  color: #0e0e0e;
  border: none;
  padding: 0.5em 1em;
  cursor: pointer;
  border-radius: 6px;
}
button.upload-btn:hover {
  background: #5600a1;
  color: #fff;
}
.profile-card {
  background: #0e0e0e;
  border: 2px solid #571728;
  padding: 1em;
  border-radius: 10px;
  margin-bottom: 1em;
}
</style>
</head>
<body>
<header>
  <h1>Lux Scepter</h1>
  <nav>
    <button id="signOutBtn">Sign Out</button>
    <button id="toggleFeed">Chrono / Algo</button>
  </nav>
</header>

<div class="container">
  <div id="feed">
    <div id="uploadSection" class="upload-section" style="display:none;">
      <h2>Upload Content</h2>
      <input type="file" id="uploadFile">
      <select id="uploadType">
        <option value="edict">Edict (vertical)</option>
        <option value="dominion">Dominion (horizontal)</option>
        <option value="throne">Throne (long-form)</option>
      </select>
      <button class="upload-btn" id="uploadBtn">Upload</button>
    </div>
    <div id="posts"></div>
  </div>
  <div class="sidebar">
    <div class="profile-card">
      <h3 id="username">@username</h3>
      <img id="avatar" src="" alt="avatar" style="width:100%; border-radius:50%;">
      <p id="banner" style="height:60px; background:#35005a; margin-top:1em;"></p>
      <a id="profileLink" href="#" target="_blank"></a>
    </div>
    <div class="profile-card">
      <h3>Crown ‚ôî: <span id="crownCount">0</span></h3>
      <h3>Daily Scepter êÄ£: <span id="scepterCount">10</span></h3>
    </div>
  </div>
</div>

<div id="oracle"></div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabaseUrl = 'https://uewvmldolwgihfkxwlsl.supabase.co'
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVld3ZtbGRvbHdnaWhmaWhmaWh3bHNsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5MzQ1MjksImV4cCI6MjA3OTUxMDUyOX0.b9C00OjIkAUDPztC8RtdHcwjdgX4OrShNW_pp6r-_qI'
const supabase = createClient(supabaseUrl, supabaseKey)

let user = null

// Sign out
document.getElementById('signOutBtn').addEventListener('click', async () => {
  await supabase.auth.signOut()
  window.location.href = 'index.html'
})

// Feed toggle (chrono/algo) ‚Äî placeholder
document.getElementById('toggleFeed').addEventListener('click', () => {
  alert('Feed toggle chrono/algo (placeholder)')
})

// Oracle Edge toggle
const oracle = document.getElementById('oracle')
oracle.addEventListener('click', () => {
  oracle.classList.toggle('expanded')
  if(oracle.classList.contains('expanded')){
    oracle.innerHTML = '<input type="text" placeholder="Search...">'
  } else {
    oracle.innerHTML = ''
  }
})

async function init() {
  const { data: { user: currentUser } } = await supabase.auth.getUser()
  if (!currentUser) window.location.href = 'index.html'
  user = currentUser

  // Load profile
  const { data: profile } = await supabase
    .from('profiles')
    .select('*')
    .eq('id', user.id)
    .single()
  
  document.getElementById('username').textContent = profile.username || '@username'
  document.getElementById('avatar').src = profile.avatar_url || 'https://via.placeholder.com/150'
  document.getElementById('profileLink').href = profile.link || '#'
  document.getElementById('profileLink').textContent = profile.link || ''

  // Show upload section if creator
  if(profile.is_creator){
    document.getElementById('uploadSection').style.display = 'block'
  }

  // Load initial posts (placeholder)
  loadPosts()
}

async function loadPosts(){
  // Replace with actual feed query
  const { data: posts } = await supabase
    .from('posts')
    .select('*')
    .order('created_at', { ascending: false })
    .limit(20)
  const postsDiv = document.getElementById('posts')
  postsDiv.innerHTML = ''
  if(!posts) return
  posts.forEach(post => {
    const postDiv = document.createElement('div')
    postDiv.className = 'post'
    postDiv.innerHTML = `
      <h4>${post.title || 'Untitled'}</h4>
      <video src="${post.url}" controls></video>
    `
    postsDiv.appendChild(postDiv)
  })
}

// Upload logic
document.getElementById('uploadBtn').addEventListener('click', async () => {
  const file = document.getElementById('uploadFile').files[0]
  const type = document.getElementById('uploadType').value
  if(!file) return alert('Select a file')

  // Use Cloudflare R2 or Supabase storage (placeholder with Supabase storage)
  const fileExt = file.name.split('.').pop()
  const fileName = `${type}/${user.id}-${Date.now()}.${fileExt}`

  const { data, error } = await supabase.storage
    .from('uploads')
    .upload(fileName, file)
  
  if(error) return alert('Upload failed: ' + error.message)

  // Save post in database
  await supabase.from('posts').insert({
    user_id: user.id,
    type: type,
    url: `https://uewvmldolwgihfkxwlsl.supabase.co/storage/v1/object/public/uploads/${fileName}`,
    created_at: new Date()
  })

  alert('Upload successful!')
  loadPosts()
})

init()
</script>
</body>
</html>
