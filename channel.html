<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Channel — Lux Scepter</title>
<style>
:root{--black:#000;--gold:#FFD700;--purple:#8A2BE2;--white:#fff;--tan:#D8C8A6}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#020202,#000);color:var(--white);font-family:"Times New Roman", Times, serif}
.container{max-width:1000px;margin:0 auto;padding:36px}
.header{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:56px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(135deg,var(--gold),var(--purple));color:#000;font-weight:800}
.banner{height:140px;border-radius:10px;background:linear-gradient(90deg, rgba(138,43,226,0.04), rgba(255,215,0,0.02));padding:12px;margin-top:16px;display:flex;align-items:center;gap:18px}
.avatar{width:120px;height:120px;border-radius:12px;background:linear-gradient(90deg,var(--purple),var(--gold))}
.btn{background:var(--gold);color:#000;border:0;padding:8px 10px;border-radius:10px;cursor:pointer}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:12px;border-radius:10px;margin-bottom:12px}
.items{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin-top:18px}
.small{font-size:13px;color:#bdbdbd}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">♛</div>
    <div>
      <div style="font-family:var(--brand-font);font-size:18px">Lux Scepter</div>
      <div class="small">Creator channel</div>
    </div>
    <div style="margin-left:auto">
      <a href="feed.html" style="color:var(--gold);text-decoration:none">Back to feed</a>
    </div>
  </div>

  <div id="channelArea">
    <div class="banner">
      <div id="avatar" class="avatar"></div>
      <div>
        <h2 id="display" style="margin:0"></h2>
        <div id="uname" class="small"></div>
        <div id="bio" class="small" style="margin-top:8px;color:#cfcfcf"></div>
      </div>
    </div>

    <h3 style="margin-top:18px">Public uploads</h3>
    <div id="items" class="items"></div>
  </div>
</div>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const SUPABASE_URL = 'https://uewvmldolwgihfkxwlsl.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVld3ZtbGRvbHdnaWhma3h3bHNsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5MzQ1MjksImV4cCI6MjA3OTUxMDUyOX0.b9C00OjIkAUDPztC8RtdHcwjdgX4OrShNW_pp6r-_qI';
  const BUCKET = 'luxscepter-uploads';
  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const params = new URLSearchParams(location.search);
  const uid = params.get('u');

  async function loadChannel(){
    let userId = uid;
    if (!userId) {
      const u = await supabase.auth.getUser();
      userId = u.data?.user?.id;
      if (!userId) return location.href='index.html';
    }

    try {
      const { data: profile, error: pErr } = await supabase.from('profiles').select('*').eq('id', userId).single();
      if (pErr) { console.error(pErr); return; }
      document.getElementById('display').textContent = profile.display_name || profile.username || 'Unnamed';
      document.getElementById('uname').textContent = '@' + (profile.username||'').toLowerCase();
      document.getElementById('bio').textContent = profile.bio || '';

      if (profile.avatar_url) {
        const publicURL = supabase.storage.from(BUCKET).getPublicUrl(profile.avatar_url).publicURL;
        const av = document.getElementById('avatar');
        av.style.backgroundImage = `url(${publicURL})`;
        av.style.backgroundSize = 'cover';
        av.style.backgroundPosition = 'center';
      }

      const { data: items, error: itErr } = await supabase.from('contents').select('id,title,kind,published_at,media:media(storage_path)').eq('author', userId).is('is_draft', false).order('published_at',{ascending:false});
      if (itErr) { console.error(itErr); return; }
      const container = document.getElementById('items');
      container.innerHTML = (items || []).map(it => {
        const title = it.title || '(untitled)';
        const when = it.published_at ? new Date(it.published_at).toLocaleString() : 'draft';
        return `<div class="card"><div style="height:140px;background:linear-gradient(90deg,var(--purple),var(--gold));border-radius:8px"></div><div style="margin-top:8px;font-weight:700">${title}</div><div class="small">${it.kind.toUpperCase()} · ${when}</div></div>`;
      }).join('') || '<div class="small">No public uploads</div>';
    } catch (e) { console.error(e); }
  }

  loadChannel();
</script>
</body>
</html>
